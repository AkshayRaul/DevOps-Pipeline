
<flow-definition plugin="workflow-job@2.31">
<actions/>
<description/>
<keepDependencies>false</keepDependencies>
<properties/>
<definition class="org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition" plugin="workflow-cps@2.63">
<script>

pipeline{
  agent any
  stages{
    stage('Clone repository'){
     steps {
        git([url:'root@134.209.115.128:/Project/ansible-srv/iTrust2/iTrust2-v4',branch:'master',credentialsId:'mykey'])
      }
    }
    stage ('Build project') {
      steps{
        dir('iTrust2'){
          sh 'mvn -f pom-data.xml process-test-classes'
          step( [ $class: 'JacocoPublisher',
                classPattern: 'target/classes',
                sourcePattern: 'src/main/java',
                exclusionPattern: 'src/test*',
                changeBuildStatus: true, maximumBranchCoverage: '100', maximumLineCoverage: '90', minimumBranchCoverage: '60', minimumLineCoverage: '70'
              ] )
        }       
        }
    }
    stage('Static Code Analysis'){
      steps{
        dir('iTrust2'){
          sh 'mvn findbugs:findbugs'
          step( [ $class: 'FindBugsPublisher',
                  canRunOnFailed: true,
                  pattern: '**/target/findbugsXml.xml',
                  canComputeNew: false, 
                  healthy: '50', 
                  unHealthy: '50'
              ] )
        }
      }
    }
    stage('Test build'){
      steps{
        dir('iTrust2'){
            sh 'mvn clean test'
        }
      }
    }
  }
  
}


</script>
<sandbox>true</sandbox>
</definition>
<triggers/>
<disabled>false</disabled>
</flow-definition>
